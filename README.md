# КЭДО

## Сокращения

* КЭДО - кадровый электронный документооборот.
* ЛК - личный кабинет.

## Описание примера

Пример включает следующие компоненты: 
- Data > KEDO.sol - решение, добавляющее в систему Docsvision новые виды для карточек Документ и Задание, а также необходимые расширенные метаданные.
- Data > KEDOSolution - папка с решением, включающим web-разметки для ЛК сотрудника.
- Extensions > InsertGreetingExtension - папка с клиентским расширением, в котором реализованы ...
- Extensions > SignatureWebExtension - папка с клиентским расширением, в котором реализованы ...
- Extensions > CustomTablesWebExtension - папка с клиентским расширением, содержит клиентский скрипт и стили для элемента управления "SampleCustomTables".
- Extensions > CustomTablesDesignerExtension - папка с расширением для Конструктора разметок, содержит описание элемента управления "SampleCustomTables".
- Images - папка с иконками для ЛК сотрудника.
- Styles - папка со стилями для ЛК сотрудника.

## Настройка среды разработки

**Перечень необходимых инструментов:** 
* [Visual Studio 2017/2019](https://www.visualstudio.com)
* [NodeJS v14.17.0+](https://nodejs.org/en/)

## Сборка примера
1. Откройте Samples.sln и соберите проект SampleCustomTablesDesignerExtension.
2. Соберите клиентские расширения:
   - Откройте командную строку и перейдите в текущую директорию.
   - Выполните команду `.\install.ps1 3`.
   - Дождитесь завершения сборки клиентских расширений. 
3. Скопируйте каталог `SamplesOutput\Plugins\SampleCustomTablesDesignerExtension` в `<Каталог установки Web-клиента>\Plugins`
4. Скопируйте каталог `SamplesOutput\Site\Content\Modules\KEDO` в `<Каталог установки Web-клиента>\Site\Content\Modules`

## Проверка примера

**Для проверки примера требуется установить:**
*  Backoffice 5.5.8650.0 или выше.
*  Web-клиент 5.5.6478.184 или выше.

1. В Менеджере Решений импортируйте решение "КЭДО" - `Data\KEDO.sol`.

    Компоненты данного решения:
    - Справочник видов: 
		1. Документ - КЭДО - Кадровый документ, Заявки сотрудника.
		2. Задание - Задание КС - На подписание КЭДО.
    - Общие роли: Сотрудник ЛК КЭДО.
    - Метаданные: Кадровые документы.
    - Конструктор правил нумерации: Кадровый документ.
    - Конструктор справочников: Кадровые документы, Заявка сотрудника.
    - Поиск: КЭДО и все подчиненные поисковые запросы.
    - Представление: КЭДО и все подчиненные.
    - Папки: КЭДО и подчиненные:
        1. Виртуальная папка "Заявки от сотрудников" для HR-специалистов.
        2. Папка "КЭДО сотрудника" для хранения маршрутов согласования и подчиненные папки для личного кабинета сотрудника.

2. В конструкторе web-разметок импортируйте решение "КЭДО". Для этого выберите файл Solution.xml в папке решения `Data\KEDOSolution`
 
3. Добавьте сотрудников, для которых необходим личный кабинет в группу "Сотрудники КЭДО" в справочнике сотрудников.

4. Добавьте сотрудников кадрового документооборота в группу "Cпециалисты по КЭДО" в справочнике сотрудников.

5. В справочнике видов (тип - Согласование, вид - Усовершенствованное согласование) настройте согласование для видов карточек Кадровый документ. Заполнините названия "Первый подписывает сотрудник" и "Первый подписывает работодатель", способ создания "Создание согласования", затем выберите соответствующие шаблоны из папки "КЭДО сотрудника".

6. В Web-клиенте добавьте папку для специалистов по КЭДО. Главное меню - Настроить - Добавить папку - "КЭДО" - "Заявки от сотрудников". 

----------

### SignatureWebExtension
По задаче TSK-4692 Убрать в подписи метку и настройки для лк кэдо
- Открыть папку SignatureWebExtension во встроенном терминале и выполнить команду npm i.
- Готовое расширение скопировать из папки SignatureWebExtension/Dist/Site/Content/Modules и поместить в `<Каталог установки Web-клиента>\Site\Content\Modules`.
- В Конструкторе Разметок открыть разметку страницы где будет происходить подписание.
- В структуре карточке выбрать documentRoot и в событие "После загрузки всех ЭУ" прописать(без кавычек) "signature".
- Перезапустить IIS

### CustomTables

Этот каталог содержит пример реализации элемента управления "CustomTables".

#### Описание контрола "SampleCustomTables"

Контрол "SampleCustomTables" содержит базовый функционал контрола "Виджет / Карточки папки" ("FolderCardsDashboardWidget") с дополнительными параметрами: изменение наименования ссылки под таблицей, добавление счетчика документов / заданий / заявок и дополнительную кнопку с заданной ссылкой и наименованием.

## Настройка среды разработки

**Перечень необходимых инструментов:** 
* [Visual Studio 2022](https://www.visualstudio.com)
* [NodeJS v14.17.0+](https://nodejs.org/en/)

## Сборка и установка

1. Открыть /Samples.sln
2. Собрать проект Controls > SampleCustomTables > CustomTablesDesignerExtension
3. Открыть консоль в папке Controls > CustomTables > CustomTablesWebExtension и выполнить команду `npm install` и `npm run build`
4. Скопировать содержимое из Controls > CustomTables > CustomTablesDesignerExtension > xml  в каталог "Путь к установленному Web-клиент\Plugins"
5. Скопировать содержимое из Controls > CustomTables > CustomTablesDesignerExtension > bin > Plugins в каталог "Путь к установленному Web-клиент\Plugins"
6. Скопировать каталог SamplesOutput\Site\Content\Modules\SampleCustomTables в каталог "Путь к установленному Web-клиенту\Site\Content\Modules"
7. Перезапустить IIS

## Проверка примера

1. Запустить конструктор разметок
2. Скопировать разметку в своё решение, изменить условие выбора разметки и добавить в разметку новый элемент управления "SampleCustomTables"
3. Задать желаемые параметры элемента управления:
    - Наименование ссылки под таблицей: наименование ссылки, расположенной под таблицей и ведущей на страницу папки, к которой подключен контрол. По умолчанию наименование - "Ещё"
    - Скрыть кнопку: управление видимостью дополнительной кнопки над таблицей. По умолчанию кнопка скрыта
    - Текст кнопки: наименование дополнительной кнопки над таблицей
    - Ссылка кнопки: ссылка, по которой будет осуществлен переход после нажатия кнопки
    - Скрыть счетчик: управление видимостью счетчика, показывающего количество документов / заданий / заявок в подключенной папке. По умолчанию счетчик скрыт
    - Скрыть таблицу: управление видимостью таблицы. По умолчанию таблица не скрыта
    - Количество карточек: максимальное количество карточек (строк), отображаемых в таблице
    - Папка: ID папки, к которой необходимо подключить контрол
    - Представление: ID представления для отображения нужных в таблице колонок
4. Сохранить разметку
5. Перезапустить IIS
8. Открыть главную страницу
9. Убедиться, что появился новый элемент управления

## Проект SampleCustomTablesWebExtension

Проект-расширение клиентской части Web-клиента. Содержит клиентский скрипт и стили для элемента управления "SampleCustomTables".

## Проект SampleCustomTablesDesignerExtension

Проект-расширение для Конструктора разметок. Содержит описание элемента управления "SampleCustomTables".